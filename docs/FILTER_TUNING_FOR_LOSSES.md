# Настройка фильтров для снижения убытков

Если бот даёт стабильный минус или большие просадки, фильтры входа можно **ужесточить**. Ниже — конкретные параметры в `configs/bot_config.py` (или через UI «Конфигурация»).

## 1. ExitScam (резкие движения цены)

Снижает вероятность входа в памп/дамп.

| Параметр | Мягко (по умолчанию) | Рекомендация при минусе |
|----------|----------------------|---------------------------|
| `EXIT_SCAM_SINGLE_CANDLE_PERCENT` | 15 | **10** |
| `EXIT_SCAM_MULTI_CANDLE_PERCENT`  | 50 | **40** |
| `EXIT_SCAM_CANDLES`               | 8  | оставить или 10 |
| `EXIT_SCAM_MULTI_CANDLE_COUNT`    | 4  | оставить |

## 2. AI Anomaly (блокировка по аномалиям)

Чем ниже порог — тем чаще блокируются «сомнительные» входы.

| Параметр | Сейчас | Рекомендация при минусе |
|----------|--------|--------------------------|
| `ANOMALY_BLOCK_THRESHOLD` (в AutoBotConfig) | 0.7 | **0.5–0.6** |
| `AI_ANOMALY_BLOCK_THRESHOLD` (в AIConfig)   | 0.7 | **0.5–0.6** |

Убедитесь, что **AI Anomaly Detection включён**: `ANOMALY_DETECTION_ENABLED = True`, `AI_ANOMALY_DETECTION_ENABLED = True`.

## 3. RSI зоны входа

Более экстремальные зоны = меньше входов, но часто «качественнее».

| Параметр | Мягко | Жёстче (меньше входов) |
|----------|--------|-------------------------|
| `RSI_LONG_THRESHOLD`  | 29 | **23–25** (входить в LONG только при RSI ≤ 25) |
| `RSI_SHORT_THRESHOLD` | 71 | **75–77** (входить в SHORT только при RSI ≥ 75) |

## 4. Стоп-лосс

Ограничивает убыток на одну сделку.

| Параметр | Рискованно | Рекомендация при минусе |
|----------|------------|--------------------------|
| `MAX_LOSS_PERCENT` | 15 | **2–3** (в DefaultBotConfig / AutoBotConfig) |

## 5. Защита от повторного входа после убытка

| Параметр | Рекомендация |
|----------|--------------|
| `LOSS_REENTRY_PROTECTION` | **True** |
| `LOSS_REENTRY_CANDLES`    | 3–5 (сколько свечей ждать после убытка) |
| `LOSS_REENTRY_COUNT`      | 1 (допустимое число убыточных подряд до блокировки) |

## 6. Чёрный список монет

Добавьте в **BLACKLIST** монеты с стабильно отрицательным PnL. Готовый список можно получить:

```bash
python scripts/analysis/filter_recommendations.py --blacklist-top 30
```

Скопируйте вывод в `configs/bot_config.py` в блок `BLACKLIST = [ ... ]` (в `DefaultAutoBotConfig` и `AutoBotConfig`). При `SCOPE = 'all'` blacklist только исключает эти монеты; при `SCOPE = 'blacklist'` торгуются все, кроме blacklist (чаще используют `all` + blacklist).

## 7. Полный отчёт и рекомендации

- **Аналитика сделок (сводка + неудачные монеты):**  
  `python scripts/analysis/trading_analytics_report.py`

- **Рекомендации по фильтрам + готовый blacklist:**  
  `python scripts/analysis/filter_recommendations.py --blacklist-top 20`

После изменения конфига перезапустите сервис ботов (или дождитесь следующего цикла проверки сигналов).
