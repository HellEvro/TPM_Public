# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ –ò–ò –Ω–∞ —Å—Ç–æ–ø–∞—Ö

## üéØ –¶–µ–ª—å –æ–±—É—á–µ–Ω–∏—è

–ò–ò –¥–æ–ª–∂–µ–Ω –Ω–∞—É—á–∏—Ç—å—Å—è:
- **–ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π SL/TP** –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç—ã
- **–ü–æ–Ω–∏–º–∞—Ç—å, –∫–æ–≥–¥–∞ –µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –±—ã–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏**
- **–ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

### 1. ‚úÖ –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

–ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –ø–æ–∑–∏—Ü–∏–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ —Å—Ç–æ–ø—É) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:
```python
entry_data = {
    'entry_price': 13.9387,
    'rsi': 16.7,  # RSI –Ω–∞ –≤—Ö–æ–¥–µ
    'volatility': 1.2,  # –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    'trend': 'UP',  # –¢—Ä–µ–Ω–¥ –Ω–∞ –≤—Ö–æ–¥–µ
    'duration_hours': 12.5,  # –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–∏
    'max_profit_achieved': 3.2  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å %
}
```

### 2. ‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –≤ —Å—Ç–æ–ø–∞—Ö

–ù–∞—Ö–æ–¥–∏—Ç –æ–±—â–∏–µ –ø—Ä–∏—á–∏–Ω—ã —Å—Ç–æ–ø–æ–≤:
```python
patterns = {
    'high_rsi_stops': 15,  # 15 —Å—Ç–æ–ø–æ–≤ –∫–æ–≥–¥–∞ RSI –±—ã–ª >70
    'low_volatility_stops': 8,  # 8 —Å—Ç–æ–ø–æ–≤ –ø—Ä–∏ –Ω–∏–∑–∫–æ–π –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
    'rapid_stops': 23,  # 23 —Å—Ç–æ–ø–∞ –∑–∞–∫—Ä—ã–ª–∏—Å—å –±—ã—Å—Ç—Ä–æ (<6—á)
    'trailing_stops': 5  # 5 —Å—Ç–æ–ø–æ–≤ –ø–æ trailing
}
```

### 3. ‚ùå –ù–ï–¢: –û–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (–æ–±—É—á–µ–Ω–∏—è)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–ò –Ω–µ –∑–Ω–∞–µ—Ç, –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–Ω –ø—Ä–µ–¥–ª–æ–∂–∏–ª SL/TP!

**–ü—Ä–∏–º–µ—Ä:**
1. –ò–ò –ø—Ä–µ–¥–ª–æ–∂–∏–ª: SL=12%, TP=100%
2. –ë–æ—Ç –æ—Ç–∫—Ä—ã–ª –ø–æ–∑–∏—Ü–∏—é —Å —ç—Ç–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
3. –ü–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å –ø–æ —Å—Ç–æ–ø—É –ø—Ä–∏ -15%
4. **–ù–æ –ò–ò –Ω–µ –∑–Ω–∞–µ—Ç**, —á—Ç–æ –µ–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –±—ã–ª–∞ –Ω–µ–≤–µ—Ä–Ω–æ–π!

## üîß –ß–¢–û –ù–£–ñ–ù–û –î–û–ë–ê–í–ò–¢–¨

### –°–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

```python
class SmartRiskManager:
    
    def evaluate_prediction(self, symbol, backtest_result, actual_outcome):
        """
        –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ò–ò –ø—Ä–µ–¥—Å–∫–∞–∑–∞–ª SL/TP
        
        Args:
            symbol: –°–∏–º–≤–æ–ª –º–æ–Ω–µ—Ç—ã
            backtest_result: –ß—Ç–æ –ò–ò –ø—Ä–µ–¥—Å–∫–∞–∑–∞–ª (–∏–∑ backtest_coin)
            actual_outcome: –ß—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ
        
        Returns:
            –û—Ü–µ–Ω–∫–∞: {'correct': True/False, 'score': 0-1}
        """
        
        # –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ
        predicted_sl = backtest_result['optimal_sl_percent']
        predicted_tp = backtest_result['optimal_tp_percent']
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        actual_entry = actual_outcome['entry_price']
        actual_exit = actual_outcome['exit_price']
        actual_result = actual_outcome['roi']
        
        # –û—Ü–µ–Ω–∏–≤–∞–µ–º —Ç–æ—á–Ω–æ—Å—Ç—å
        # –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å –º–µ–∂–¥—É predicted_sl –∏ predicted_tp ‚Üí —Ö–æ—Ä–æ—à–æ
        # –ï—Å–ª–∏ –≤—ã—à–ª–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã ‚Üí –ø–ª–æ—Ö–æ
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
        self._save_feedback(symbol, {
            'predicted_sl': predicted_sl,
            'predicted_tp': predicted_tp,
            'actual_result': actual_result,
            'score': self._calculate_score(predicted_sl, predicted_tp, actual_result)
        })
    
    def _save_feedback(self, symbol, feedback):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –¥–ª—è –æ–±—É—á–µ–Ω–∏—è"""
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Ñ–∞–π–ª –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
        # data/ai/training/feedback_{symbol}.json
```

### –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏

```python
def learn_from_feedback(self):
    """–û–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏"""
    
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ feedback
    all_feedback = self._load_all_feedback()
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
    for symbol, feedbacks in all_feedback.items():
        # –°—Ä–µ–¥–Ω–∏–π score –¥–ª—è —ç—Ç–æ–π –º–æ–Ω–µ—Ç—ã
        avg_score = np.mean([f['score'] for f in feedbacks])
        
        # –ï—Å–ª–∏ score –Ω–∏–∑–∫–∏–π ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if avg_score < 0.5:
            # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º SL –¥–ª—è —ç—Ç–æ–π –º–æ–Ω–µ—Ç—ã
            self._adjust_parameters(symbol, {
                'sl_multiplier': 1.2,  # +20% –∫ SL
                'tp_multiplier': 0.9   # -10% –∫ TP
            })
```

## üíæ –ö—É–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ–ø—ã—Ç?

### 1. –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–æ–ø–æ–≤ (`data/bot_history.json`)
```json
{
  "trades": [
    {
      "symbol": "OG",
      "direction": "LONG",
      "entry_price": 13.9387,
      "exit_price": 13.7715,
      "roi": -14.99,
      "close_reason": "STOP_LOSS_-15%",
      "entry_data": {
        "rsi": 16.7,
        "volatility": 1.2,
        "trend": "UP"
      }
    }
  ]
}
```

### 2. –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å (`data/ai/training/feedback_*.json`)
```json
{
  "symbol": "OG",
  "feedback": [
    {
      "predicted_sl": 12,
      "predicted_tp": 100,
      "actual_result": -14.99,
      "score": 0.3,
      "timestamp": "2025-10-27T04:00:00"
    }
  ]
}
```

### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`data/ai/training/optimized_params.json`)
```json
{
  "OG": {
    "sl_multiplier": 1.2,
    "tp_multiplier": 0.9,
    "last_updated": "2025-10-27",
    "accuracy": 0.65
  }
}
```

## üîÑ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è

```
1. –ë–û–¢ –û–¢–ö–†–´–í–ê–ï–¢ –ü–û–ó–ò–¶–ò–Æ
   ‚îî‚îÄ SmartRiskManager.backtest_coin() –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç: SL=12%, TP=100%
   ‚îî‚îÄ –ë–æ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å —ç—Ç–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

2. –ü–û–ó–ò–¶–ò–Ø –ó–ê–ö–†–´–í–ê–ï–¢–°–Ø
   ‚îî‚îÄ –ü—Ä–∏—á–∏–Ω–∞: STOP_LOSS (—Ä–µ–∞–ª—å–Ω—ã–π SL –±—ã–ª -15%)
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ–º: entry_data, market_data

3. –û–ë–†–ê–¢–ù–ê–Ø –°–í–Ø–ó–¨
   ‚îî‚îÄ SmartRiskManager.evaluate_prediction()
   ‚îî‚îÄ –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º: –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–π SL vs —Ä–µ–∞–ª—å–Ω—ã–π ROI
   ‚îî‚îÄ Score: 0.3 (–ø–ª–æ—Ö–æ, —Ç.–∫. -15% > -12%)

4. –û–ë–£–ß–ï–ù–ò–ï
   ‚îî‚îÄ smart_risk_manager.learn_from_feedback()
   ‚îî‚îÄ –î–ª—è OG: —É–≤–µ–ª–∏—á–∏—Ç—å SL —Å 12% –¥–æ 14.4%
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ optimized_params.json

5. –°–õ–ï–î–£–Æ–©–ò–ô –í–•–û–î –í OG
   ‚îî‚îÄ SmartRiskManager.backtest_coin()
   ‚îî‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç: SL=14.4% (–∏–∑ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
   ‚îî‚îÄ –ë–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ!
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

```python
def _calculate_score(self, predicted_sl, predicted_tp, actual_result):
    """
    –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–æ –ò–ò –ø—Ä–µ–¥—Å–∫–∞–∑–∞–ª
    
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0-1:
    - 1.0 = –∏–¥–µ–∞–ª—å–Ω–æ (–ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ SL-TP)
    - 0.5 = —Å—Ä–µ–¥–Ω–µ (–±–ª–∏–∑–∫–æ –∫ SL)
    - 0.0 = –ø–ª–æ—Ö–æ (–≤—ã–π—à–ª–æ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã)
    """
    
    if actual_result < -predicted_sl:
        # –í—ã—à–ª–∏ –∑–∞ SL ‚Üí –ø–ª–æ—Ö–æ
        return 0.0
    
    if actual_result > predicted_tp:
        # –ü—Ä–µ–≤—ã—Å–∏–ª–∏ TP ‚Üí —Ö–æ—Ä–æ—à–æ, –Ω–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–æ
        return 0.8
    
    # –í –ø—Ä–µ–¥–µ–ª–∞—Ö SL-TP
    normalized = (actual_result + predicted_sl) / (predicted_tp + predicted_sl)
    return normalized
```

## üéØ –ò—Ç–æ–≥

**–°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- ‚úÖ –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–æ–ø–∞—Ö
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ò–ò –º–æ–¥—É–ª–µ–π (LSTM, Anomaly, Risk Manager)

**–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- ‚ùå –°–∏—Å—Ç–µ–º—É –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
- ‚ùå –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ (scores)
- ‚ùå –û–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ scores
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

