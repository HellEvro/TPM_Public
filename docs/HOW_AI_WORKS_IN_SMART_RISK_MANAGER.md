# –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ò–ò –≤ SmartRiskManager

## üîó –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ò–ò –º–æ–¥—É–ª–∏

### 1. ü§ñ LSTM Predictor
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã (UP/DOWN)
- –î–∞—ë—Ç confidence –¥–ª—è —Å–≤–æ–µ–≥–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
```python
lstm_prediction = self.lstm_predictor.predict(candles, current_price)
# –ï—Å–ª–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Üí +15% –∫ confidence
if predicted_direction == direction:
    confidence += 0.15
```

### 2. üìä Anomaly Detector  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –≤ —Ü–µ–Ω–µ (pump/dump/manipulation)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç severity (0-1)

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
```python
anomaly_score = self.anomaly_detector.detect(candles)
# –ï—Å–ª–∏ –∞–Ω–æ–º–∞–ª–∏—è ‚Üí -30% –æ—Ç severity –∫ confidence
if anomaly_score.get('is_anomaly'):
    confidence -= severity * 0.3
```

### 3. üéØ Risk Manager (DynamicRiskManager)
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç SL/TP –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å–∏–ª—É —Ç—Ä–µ–Ω–¥–∞
- –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
```python
risk_analysis = self.risk_manager.calculate_dynamic_sl(symbol, candles, direction)
optimal_sl_from_risk = risk_analysis.get('sl_percent')  # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π SL

risk_tp_analysis = self.risk_manager.calculate_dynamic_tp(symbol, candles, direction)
optimal_tp_from_risk = risk_tp_analysis.get('tp_percent')  # –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π TP
```

### 4. üìà –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–æ–ø–æ–≤ (–æ–±—É—á–µ–Ω–∏–µ)
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ—á–µ–º—É —Å–¥–µ–ª–∫–∏ –∑–∞–∫—Ä—ã–ª–∏—Å—å –ø–æ —Å—Ç–æ–ø—É
- –í—ã—è–≤–ª—è–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–≤—ã—Å–æ–∫–∏–π RSI, –Ω–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, –±—ã—Å—Ç—Ä—ã–µ —Å—Ç–æ–ø—ã)
- –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç SL/TP –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
```python
# –ü–æ–ª—É—á–∞–µ–º —Å—Ç–æ–ø—ã –¥–ª—è –º–æ–Ω–µ—Ç—ã
coin_stops = self._get_coin_stops(symbol)

if coin_stops:
    optimal_sl_from_history = self._optimal_sl_for_coin(coin_stops, volatility)
    optimal_tp_from_history = self._optimal_tp_for_coin(coin_stops, trend_strength)
```

## üéØ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

```python
# –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–µ: 60% –ò–ò —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, 40% –∏—Å—Ç–æ—Ä–∏—è
optimal_sl = (optimal_sl_from_risk * 0.6) + (optimal_sl_from_history * 0.4)
optimal_tp = (optimal_tp_from_risk * 0.6) + (optimal_tp_from_history * 0.4)

# –ò—Ç–æ–≥–æ–≤—ã–π confidence:
confidence = base_confidence + lstm_bonus - anomaly_penalty
```

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –ë–µ–∑ –ò–ò (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è):
- SL: 15% (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ)
- TP: 100% (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ)
- Confidence: 0.5

### –° –ò–ò (–ø—Ä–µ–º–∏—É–º):
- SL: 13.2% (LSTM 12%, History 15%, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å —Å—Ä–µ–¥–Ω—è—è)
- TP: 105% (Risk Manager 110%, History 95%)
- Confidence: 0.72 (–±–∞–∑–æ–≤—ã–π 0.5 + LSTM +0.15 + –Ω–µ—Ç –∞–Ω–æ–º–∞–ª–∏–π)
- Anomaly: False
- Trend strength: 0.68 (—Å–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥)

## üîÑ –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å—Ç–æ–ø–∞—Ö

–ö–æ–≥–¥–∞ —Å–¥–µ–ª–∫–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ —Å—Ç–æ–ø—É:
1. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ: RSI –Ω–∞ –≤—Ö–æ–¥–µ, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å, max profit, duration
2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ LSTM - –ø–æ—á–µ–º—É —Å—Ç–æ–ø?
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Anomaly Detector - –±—ã–ª–∞ –ª–∏ –∞–Ω–æ–º–∞–ª–∏—è?
4. –ü–∞—Ç—Ç–µ—Ä–Ω –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–±—É—á–µ–Ω–∏—è: "–í—Ö–æ–¥ –ø—Ä–∏ RSI > 70 ‚Üí —á–∞—Å—Ç—ã–π —Å—Ç–æ–ø"

–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—Ö–æ–¥–µ:
- –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π RSI > 70 ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å SL —Å 12% –¥–æ 14%
- –ï—Å–ª–∏ –Ω–∏–∑–∫–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å ‚Üí —É–º–µ–Ω—å—à–∏—Ç—å TP —Å 100% –¥–æ 80%
- –ï—Å–ª–∏ –±—ã—Å—Ç—Ä—ã–µ —Å—Ç–æ–ø—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ ‚Üí —É–≤–µ–ª–∏—á–∏—Ç—å TP —Å 80% –¥–æ 120%

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–£—á–∏—Ç—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö** - –∫–∞–∂–¥—ã–π —Å—Ç–æ–ø –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É —É–º–Ω–µ–µ
2. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** - SL/TP –º–µ–Ω—è—é—Ç—Å—è –ø–æ–¥ —É—Å–ª–æ–≤–∏—è —Ä—ã–Ω–∫–∞
3. **–£—á–∏—Ç—ã–≤–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏** - –∏–∑–±–µ–≥–∞–µ—Ç –≤—Ö–æ–¥–æ–≤ –ø—Ä–∏ pump/dump
4. **–ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - LSTM –¥–∞—ë—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª
5. **–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –ª–∏—Ü–µ–Ω–∑–∏–µ–π** - –ø—Ä–µ–º–∏—É–º —Ñ—É–Ω–∫—Ü–∏—è

## üîí –ë–µ–∑ –ª–∏—Ü–µ–Ω–∑–∏–∏

–ï—Å–ª–∏ –ª–∏—Ü–µ–Ω–∑–∏–∏ –Ω–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `DynamicRiskManager` (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π)
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ 15% SL, 100% TP
- –ë–µ–∑ LSTM, Anomaly Detector, –æ–±—É—á–µ–Ω–∏—è –Ω–∞ —Å—Ç–æ–ø–∞—Ö
- –ë–µ–∑ –±—ç–∫—Ç–µ—Å—Ç–æ–≤

