# Аудит хардкода 6h в коде

## Критические места (требуют исправления)

### 1. `bot_engine/smart_rsi_manager.py` ⚠️ КРИТИЧНО
- **Строки 3, 39, 42-86, 113, 157, 163, 203, 257, 259**: Полностью завязан на 6h свечи
- **Проблема**: Рассчитывает время закрытия свечи только для 6h, не учитывает текущий таймфрейм системы
- **Исправление**: Нужно получать текущий таймфрейм из конфига и рассчитывать время закрытия для любого таймфрейма

### 2. `bots_modules/bot_class.py` 
- **Строка 188**: `_default_tf = '6h'` - fallback только если не удалось получить текущий таймфрейм
- **Статус**: ⚠️ Менее критично, но можно улучшить - использовать `get_current_timeframe()` с fallback

### 3. `bots_modules/filters.py`
- **Строка 3625**: `current_timeframe = '6h'  # Fallback` - fallback только если не удалось получить текущий таймфрейм
- **Статус**: ⚠️ Менее критично, но можно улучшить

### 4. `bot_engine/bots_database.py`
- **Строки 1152, 1155**: `current_timeframe = '6h'  # Fallback` - fallback для обратной совместимости
- **Строка 1715**: `entry_timeframe = bot_data.get('entry_timeframe') or '6h'` - для старых ботов из БД
- **Статус**: ✅ Нормально - это для обратной совместимости со старыми данными

## Фронтенд (JavaScript)

### 5. `static/js/managers/bots_manager.js`
- **Множество мест**: `|| '6h'` как fallback значение
- **Строки**: 63, 557, 710, 858, 905, 925, 1318, 1344, 1543, 1588, 2002, 2118, 2843, 9083, 9110, 9322, 9381, 11463, 11468, 11487
- **Статус**: ⚠️ Fallback значения, используются только если не удалось получить таймфрейм из API
- **Рекомендация**: Можно оставить как есть, но лучше получать дефолт из API

### 6. `templates/pages/bots.html`
- **Строка 75**: `<span id="currentTimeframeDisplay">6H</span>` - начальное значение
- **Статус**: ✅ Нормально - это только начальное значение, обновляется через JS

## Конфигурационные файлы (нормально)

### 7. `bot_engine/bot_config.py`
- **Строка 46**: `TIMEFRAME = '6h'` - дефолтное значение конфига
- **Статус**: ✅ Нормально - это дефолт, может быть изменен через UI/API

### 8. `bot_engine/bot_config.example.py`
- **Статус**: ✅ Нормально - примеры конфигов

## Документация (не критично)

### 9. Различные `.md` файлы
- Множество упоминаний 6h в документации
- **Статус**: ✅ Нормально - это документация, можно обновить позже

## Скрипты и утилиты

### 10. `scripts/check_coin_status.py`
- **Строки 46-47, 58-59**: Использует `rsi6h` и `trend6h`
- **Статус**: ⚠️ Можно улучшить - использовать текущий таймфрейм

### 11. `scripts/sync_open_positions_to_history.py`
- **Строки 97-98**: Использует `rsi6h` и `trend6h`
- **Статус**: ⚠️ Можно улучшить - использовать текущий таймфрейм

### 12. `bots_modules/maturity.py`
- **Строка 52**: `MATURITY_CANONICAL_TIMEFRAME = '6h'`
- **Статус**: ⚠️ Вопрос - это для проверки зрелости, возможно нормально использовать фиксированный ТФ

## База данных

### 13. `bot_engine/ai/ai_database.py`
- **Множество мест**: `timeframe: str = '6h'` как дефолтный параметр
- **Статус**: ✅ Нормально - дефолтные параметры функций, могут быть переопределены

## Итоговые рекомендации

### Приоритет 1 (Критично):
1. ✅ **`bot_engine/smart_rsi_manager.py`** - полностью переделать для поддержки любого таймфрейма

### Приоритет 2 (Желательно):
2. ⚠️ **`bots_modules/bot_class.py`** - улучшить fallback логику
3. ⚠️ **`bots_modules/filters.py`** - улучшить fallback логику
4. ⚠️ **Скрипты** (`check_coin_status.py`, `sync_open_positions_to_history.py`) - использовать текущий таймфрейм

### Приоритет 3 (Опционально):
5. ⚠️ **Фронтенд** - улучшить получение дефолтного таймфрейма из API
6. ⚠️ **Документация** - обновить упоминания 6h

### Оставить как есть:
- Конфигурационные файлы (дефолты)
- База данных (дефолтные параметры функций)
- Обратная совместимость в `bots_database.py`
